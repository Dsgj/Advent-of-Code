<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advent of Code - Day 02 - Gift Shop</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --terminal-green: #00ff41;
            --terminal-dark-green: #003b00;
            --terminal-bg: #0a0f0a;
            --glow-color: #00ff41;
        }

        body {
            background: var(--terminal-bg);
            font-family: 'VT323', monospace;
            color: var(--terminal-green);
            min-height: 100vh;
            overflow: hidden;
        }

        /* CRT Screen Effect */
        .crt-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        .crt-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(transparent 50%,
                    rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 100;
        }

        .crt-container::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center,
                    transparent 0%,
                    rgba(0, 0, 0, 0.4) 100%);
            pointer-events: none;
            z-index: 101;
        }

        .terminal {
            padding: 15px;
            height: 100vh;
            max-height: 100vh;
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow: hidden;
        }

        /* ASCII Art Header */
        .ascii-header {
            text-align: center;
            font-size: 12px;
            line-height: 1.1;
            text-shadow: 0 0 10px var(--glow-color), 0 0 20px var(--glow-color);
            white-space: pre;
            animation: flicker 0.15s infinite alternate;
            flex-shrink: 0;
        }

        @keyframes flicker {
            0% {
                opacity: 0.97;
            }

            100% {
                opacity: 1;
            }
        }

        /* Main Display Area */
        .display-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr auto;
            gap: 15px;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        .panel {
            background: rgba(0, 60, 0, 0.15);
            border: 2px solid var(--terminal-green);
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.2),
                inset 0 0 30px rgba(0, 255, 65, 0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }

        .panel-title {
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--terminal-dark-green);
            text-shadow: 0 0 8px var(--glow-color);
        }

        /* Scanner Panel */
        .scanner-content {
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .scan-lines {
            font-size: 16px;
            line-height: 1.6;
            overflow-y: auto;
            height: 100%;
            padding-right: 10px;
        }

        .scan-line {
            opacity: 0.6;
            transition: all 0.2s;
        }

        .scan-line.active {
            opacity: 1;
            text-shadow: 0 0 10px var(--glow-color);
        }

        .scan-line.valid {
            color: #555;
        }

        .scan-line.invalid {
            color: #ff4141;
            text-shadow: 0 0 10px #ff4141;
        }

        .range-header {
            color: #00ccff;
            text-shadow: 0 0 10px #00ccff;
            margin-top: 10px;
            font-size: 14px;
        }

        /* Pattern Analysis Panel */
        .pattern-display {
            font-size: 48px;
            text-align: center;
            margin: 20px 0;
            text-shadow: 0 0 20px var(--glow-color), 0 0 40px var(--glow-color);
            letter-spacing: 5px;
        }

        .pattern-breakdown {
            font-size: 24px;
            text-align: center;
            margin: 10px 0;
        }

        .pattern-part {
            display: inline-block;
            padding: 5px 10px;
            margin: 0 5px;
            border: 1px dashed var(--terminal-green);
            animation: pulse 1s infinite alternate;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 5px var(--glow-color);
            }

            100% {
                box-shadow: 0 0 15px var(--glow-color), 0 0 25px var(--glow-color);
            }
        }

        .pattern-info {
            text-align: center;
            font-size: 16px;
            color: #888;
            margin-top: 10px;
        }

        /* Stats Panel */
        .stats-panel {
            grid-column: 1 / -1;
            flex-shrink: 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            text-align: center;
        }

        .stat-box {
            background: rgba(0, 60, 0, 0.2);
            padding: 10px;
            border: 1px solid var(--terminal-dark-green);
        }

        .stat-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 22px;
            text-shadow: 0 0 10px var(--glow-color);
            margin-top: 3px;
            word-break: break-all;
        }

        .stat-value.total {
            color: #ffcc00;
            text-shadow: 0 0 10px #ffcc00, 0 0 20px #ffcc00;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            padding: 10px 0;
            flex-shrink: 0;
        }

        .btn {
            font-family: 'VT323', monospace;
            font-size: 18px;
            padding: 10px 30px;
            background: transparent;
            border: 2px solid var(--terminal-green);
            color: var(--terminal-green);
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: var(--terminal-green);
            color: var(--terminal-bg);
            box-shadow: 0 0 20px var(--glow-color);
        }

        .btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .btn.active {
            background: var(--terminal-green);
            color: var(--terminal-bg);
        }

        /* Speed Control */
        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .speed-control input {
            width: 100px;
            accent-color: var(--terminal-green);
        }

        /* Cursor blink */
        .cursor {
            display: inline-block;
            width: 10px;
            height: 20px;
            background: var(--terminal-green);
            animation: blink 1s step-end infinite;
            vertical-align: middle;
            margin-left: 5px;
        }

        @keyframes blink {
            50% {
                opacity: 0;
            }
        }

        /* Part toggle */
        .part-toggle {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 5px;
            flex-shrink: 0;
        }

        .part-btn {
            padding: 5px 20px;
            font-size: 14px;
        }

        .part-btn.active {
            background: var(--terminal-green);
            color: var(--terminal-bg);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--terminal-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--terminal-dark-green);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--terminal-green);
        }
    </style>
</head>

<body>
    <div class="crt-container">
        <div class="terminal">
            <pre class="ascii-header">
 ██████╗ ██╗███████╗████████╗    ███████╗██╗  ██╗ ██████╗ ██████╗ 
██╔════╝ ██║██╔════╝╚══██╔══╝    ██╔════╝██║  ██║██╔═══██╗██╔══██╗
██║  ███╗██║█████╗     ██║       ███████╗███████║██║   ██║██████╔╝
██║   ██║██║██╔══╝     ██║       ╚════██║██╔══██║██║   ██║██╔═══╝ 
╚██████╔╝██║██║        ██║       ███████║██║  ██║╚██████╔╝██║     
 ╚═════╝ ╚═╝╚═╝        ╚═╝       ╚══════╝╚═╝  ╚═╝ ╚═════╝ ╚═╝     
            ══════ DATABASE SCANNER v2.0 ══════
            </pre>

            <div class="part-toggle">
                <button class="btn part-btn active" data-part="1">Part 1</button>
                <button class="btn part-btn" data-part="2">Part 2</button>
            </div>

            <div class="display-area">
                <div class="panel">
                    <div class="panel-title">▸ ID Scanner</div>
                    <div class="scanner-content">
                        <div class="scan-lines" id="scanLines">
                            <div class="scan-line">Awaiting scan initialization...</div>
                            <div class="scan-line"><span class="cursor"></span></div>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-title">▸ Pattern Analysis</div>
                    <div id="patternDisplay" class="pattern-display">---</div>
                    <div id="patternBreakdown" class="pattern-breakdown"></div>
                    <div id="patternInfo" class="pattern-info">Waiting for invalid ID...</div>
                </div>

                <div class="panel stats-panel">
                    <div class="panel-title">▸ Statistics</div>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-label">Current Range</div>
                            <div class="stat-value" id="currentRange">-</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">IDs Scanned</div>
                            <div class="stat-value" id="idsScanned">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Invalid Found</div>
                            <div class="stat-value" id="invalidFound">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Total Sum</div>
                            <div class="stat-value total" id="totalSum">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="btn" id="btnRun">▶ Run</button>
                <button class="btn" id="btnStep">⏭ Step</button>
                <button class="btn" id="btnReset">↺ Reset</button>
                <div class="speed-control">
                    <span>Speed:</span>
                    <input type="range" id="speedSlider" min="1" max="100" value="50">
                </div>
            </div>
        </div>
    </div>

    <script>
        // Example input
        const EXAMPLE_INPUT = "11-22,95-115,998-1012,1188511880-1188511890,222220-222224,1698522-1698528,446443-446449,38593856-38593862,565653-565659,824824821-824824827,2121212118-2121212124";

        // Real input
        const REAL_INPUT = "9191906840-9191941337,7671-13230,2669677096-2669816099,2-12,229599-392092,48403409-48523311,96763-229430,1919163519-1919240770,74928-96389,638049-668065,34781-73835,736781-819688,831765539-831907263,5615884-5749554,14101091-14196519,7134383-7169141,413340-625418,849755289-849920418,7745350-7815119,16717-26267,4396832-4549887,87161544-87241541,4747436629-4747494891,335-549,867623-929630,53-77,1414-3089,940604-1043283,3444659-3500714,3629-7368,79-129,5488908-5597446,97922755-98097602,182-281,8336644992-8336729448,24-47,613-1077";

        let currentPart = 1;
        let ranges = [];
        let invalidIds = [];
        let currentRangeIndex = 0;
        let currentInvalidIndex = 0;
        let isRunning = false;
        let animationTimeout = null;
        let stats = { scanned: 0, invalid: 0, sum: 0n };

        // DOM elements
        const scanLines = document.getElementById('scanLines');
        const patternDisplay = document.getElementById('patternDisplay');
        const patternBreakdown = document.getElementById('patternBreakdown');
        const patternInfo = document.getElementById('patternInfo');
        const currentRangeEl = document.getElementById('currentRange');
        const idsScannedEl = document.getElementById('idsScanned');
        const invalidFoundEl = document.getElementById('invalidFound');
        const totalSumEl = document.getElementById('totalSum');
        const btnRun = document.getElementById('btnRun');
        const btnStep = document.getElementById('btnStep');
        const btnReset = document.getElementById('btnReset');
        const speedSlider = document.getElementById('speedSlider');

        // Part 1: Check if number is pattern repeated exactly twice
        function isInvalidPart1(numStr) {
            const len = numStr.length;
            if (len % 2 !== 0) return false;
            const half = len / 2;
            const first = numStr.substring(0, half);
            const second = numStr.substring(half);
            return first === second && first[0] !== '0';
        }

        // Part 2: Check if number is pattern repeated 2+ times
        function isInvalidPart2(numStr) {
            const len = numStr.length;
            for (let patternLen = 1; patternLen <= len / 2; patternLen++) {
                if (len % patternLen !== 0) continue;
                const pattern = numStr.substring(0, patternLen);
                if (pattern[0] === '0') continue;
                let matches = true;
                for (let i = patternLen; i < len; i += patternLen) {
                    if (numStr.substring(i, i + patternLen) !== pattern) {
                        matches = false;
                        break;
                    }
                }
                if (matches) return { valid: true, pattern, count: len / patternLen };
            }
            return { valid: false };
        }

        // Get pattern info for display
        function getPatternInfo(numStr) {
            const len = numStr.length;
            for (let patternLen = 1; patternLen <= len / 2; patternLen++) {
                if (len % patternLen !== 0) continue;
                const pattern = numStr.substring(0, patternLen);
                if (pattern[0] === '0') continue;
                let matches = true;
                for (let i = patternLen; i < len; i += patternLen) {
                    if (numStr.substring(i, i + patternLen) !== pattern) {
                        matches = false;
                        break;
                    }
                }
                if (matches) {
                    return { pattern, count: len / patternLen };
                }
            }
            return null;
        }

        // Parse ranges
        function parseRanges(input) {
            return input.split(',')
                .filter(p => p.trim())
                .map(p => {
                    const [start, end] = p.trim().split('-');
                    return { start: BigInt(start), end: BigInt(end) };
                });
        }

        // Generate invalid numbers of specific length
        function generateInvalidNumbers(totalDigits, part) {
            const result = [];
            const seen = new Set();

            if (part === 1) {
                if (totalDigits % 2 !== 0) return [];
                const halfLen = totalDigits / 2;
                const minHalf = halfLen === 1 ? 1n : 10n ** BigInt(halfLen - 1);
                const maxHalf = 10n ** BigInt(halfLen) - 1n;
                for (let h = minHalf; h <= maxHalf; h++) {
                    const str = h.toString();
                    const repeated = str + str;
                    result.push(BigInt(repeated));
                }
            } else {
                for (let patternLen = 1; patternLen <= totalDigits / 2; patternLen++) {
                    if (totalDigits % patternLen !== 0) continue;
                    const repetitions = totalDigits / patternLen;
                    const minPattern = patternLen === 1 ? 1n : 10n ** BigInt(patternLen - 1);
                    const maxPattern = 10n ** BigInt(patternLen) - 1n;
                    for (let p = minPattern; p <= maxPattern; p++) {
                        const patternStr = p.toString();
                        const repeated = patternStr.repeat(repetitions);
                        if (!seen.has(repeated)) {
                            seen.add(repeated);
                            result.push(BigInt(repeated));
                        }
                    }
                }
            }
            return result.sort((a, b) => a < b ? -1 : a > b ? 1 : 0);
        }

        // Find all invalid IDs in ranges
        function findAllInvalidIds(ranges, part) {
            const result = [];
            const seen = new Set();

            for (const range of ranges) {
                const startLen = range.start.toString().length;
                const endLen = range.end.toString().length;
                const rangeInvalids = [];

                for (let len = startLen; len <= endLen; len++) {
                    const invalids = generateInvalidNumbers(len, part);
                    for (const num of invalids) {
                        if (num >= range.start && num <= range.end) {
                            const key = num.toString();
                            if (!seen.has(key)) {
                                seen.add(key);
                                rangeInvalids.push(num);
                            }
                        }
                    }
                }
                result.push({ range, invalids: rangeInvalids });
            }
            return result;
        }

        // Format large numbers
        function formatNumber(n) {
            return n.toLocaleString();
        }

        // Add scan line
        function addScanLine(text, className = '') {
            const line = document.createElement('div');
            line.className = 'scan-line ' + className;
            line.textContent = text;
            scanLines.appendChild(line);
            scanLines.scrollTop = scanLines.scrollHeight;
        }

        // Update pattern display
        function showPattern(numStr) {
            const info = getPatternInfo(numStr);
            patternDisplay.textContent = numStr;

            if (info) {
                let breakdown = '';
                for (let i = 0; i < info.count; i++) {
                    breakdown += `<span class="pattern-part">${info.pattern}</span>`;
                }
                patternBreakdown.innerHTML = breakdown;
                patternInfo.textContent = `Pattern "${info.pattern}" × ${info.count}`;
            }
        }

        // Get speed from slider
        function getDelay() {
            return 1000 - (speedSlider.value * 9);
        }

        // Build a step-by-step animation queue that shows the algorithm
        let animationQueue = [];
        let queueIndex = 0;

        function buildAnimationQueue(ranges, part) {
            const queue = [];
            const seen = new Set();
            let totalSum = 0n;
            let totalInvalid = 0;

            for (let rangeIdx = 0; rangeIdx < ranges.length; rangeIdx++) {
                const range = ranges[rangeIdx];
                const startLen = range.start.toString().length;
                const endLen = range.end.toString().length;

                // Step: Show which range we're processing
                queue.push({
                    type: 'range-start',
                    rangeIdx,
                    totalRanges: ranges.length,
                    range,
                    startLen,
                    endLen
                });

                let foundInRange = false;

                // For each digit length
                for (let len = startLen; len <= endLen; len++) {
                    // Check if this length can have invalid patterns
                    const hasPatterns = part === 1 ? (len % 2 === 0) : (len >= 2);

                    if (!hasPatterns) continue;

                    // Step: Show which length we're generating
                    queue.push({
                        type: 'length-check',
                        len,
                        part
                    });

                    // Generate invalid numbers of this length
                    const invalids = generateInvalidNumbers(len, part);

                    // Step: Show how many patterns of this length exist
                    queue.push({
                        type: 'patterns-generated',
                        len,
                        count: invalids.length
                    });

                    // Check each invalid number against the range
                    for (const num of invalids) {
                        if (num >= range.start && num <= range.end) {
                            const key = num.toString();
                            if (!seen.has(key)) {
                                seen.add(key);
                                totalInvalid++;
                                totalSum += num;
                                foundInRange = true;

                                // Step: Found an invalid ID in range!
                                queue.push({
                                    type: 'found-invalid',
                                    num,
                                    totalInvalid,
                                    totalSum
                                });
                            }
                        }
                    }
                }

                if (!foundInRange) {
                    queue.push({
                        type: 'no-invalid-in-range'
                    });
                }
            }

            // Final step
            queue.push({
                type: 'complete',
                totalInvalid,
                totalSum
            });

            return queue;
        }

        // Process one step from the queue
        function step() {
            if (queueIndex >= animationQueue.length) {
                isRunning = false;
                btnRun.textContent = '▶ Run';
                return false;
            }

            const item = animationQueue[queueIndex];
            queueIndex++;

            switch (item.type) {
                case 'range-start':
                    addScanLine('');
                    addScanLine(`▸ RANGE ${item.rangeIdx + 1}/${item.totalRanges}: ${item.range.start.toString()} → ${item.range.end.toString()}`, 'range-header');
                    addScanLine(`  Checking digit lengths: ${item.startLen} to ${item.endLen}`, 'valid');
                    currentRangeEl.textContent = `${item.rangeIdx + 1}/${item.totalRanges}`;
                    patternDisplay.textContent = '...';
                    patternBreakdown.innerHTML = '';
                    patternInfo.textContent = 'Analyzing range...';
                    break;

                case 'length-check':
                    const desc = item.part === 1
                        ? `(pattern × 2)`
                        : `(pattern × 2+)`;
                    addScanLine(`  → Length ${item.len} ${desc}`, 'valid');
                    break;

                case 'patterns-generated':
                    addScanLine(`    Generated ${item.count} candidate patterns`, 'valid');
                    stats.scanned += item.count;
                    idsScannedEl.textContent = formatNumber(stats.scanned);
                    break;

                case 'found-invalid':
                    const numStr = item.num.toString();
                    addScanLine(`    ✓ FOUND: ${numStr}`, 'invalid');
                    showPattern(numStr);
                    stats.invalid = item.totalInvalid;
                    stats.sum = item.totalSum;
                    invalidFoundEl.textContent = formatNumber(stats.invalid);
                    totalSumEl.textContent = stats.sum.toString();
                    break;

                case 'no-invalid-in-range':
                    addScanLine(`  ✗ No invalid IDs in this range`, 'valid');
                    break;

                case 'complete':
                    addScanLine('');
                    addScanLine('════════════════════════════════════════');
                    addScanLine(`SCAN COMPLETE`, 'active');
                    addScanLine(`Total Invalid IDs: ${item.totalInvalid}`, 'active');
                    addScanLine(`Sum: ${item.totalSum.toString()}`, 'active');
                    isRunning = false;
                    btnRun.textContent = '▶ Run';
                    break;
            }

            return true;
        }

        // Run animation
        function run() {
            if (step()) {
                animationTimeout = setTimeout(run, getDelay());
            }
        }

        // Initialize
        function init() {
            ranges = parseRanges(REAL_INPUT);
            animationQueue = buildAnimationQueue(ranges, currentPart);
            queueIndex = 0;
            stats = { scanned: 0, invalid: 0, sum: 0n };

            scanLines.innerHTML = '';
            addScanLine('NORTH POLE GIFT SHOP - DATABASE AUDIT SYSTEM');
            addScanLine('════════════════════════════════════════════');
            addScanLine(`Loading ${ranges.length} product ID ranges...`);
            addScanLine(`Mode: Part ${currentPart} (pattern × ${currentPart === 1 ? '2' : '2+'})`);
            addScanLine('');
            addScanLine('Algorithm: Generate invalid patterns by length,');
            addScanLine('           then check if they fall within range.');
            addScanLine('');
            addScanLine('Ready. Press RUN or STEP to begin.');

            patternDisplay.textContent = '---';
            patternBreakdown.innerHTML = '';
            patternInfo.textContent = 'Waiting for analysis...';
            currentRangeEl.textContent = '-';
            idsScannedEl.textContent = '0';
            invalidFoundEl.textContent = '0';
            totalSumEl.textContent = '0';
        }

        // Event listeners
        btnRun.addEventListener('click', () => {
            if (isRunning) {
                isRunning = false;
                clearTimeout(animationTimeout);
                btnRun.textContent = '▶ Run';
            } else {
                isRunning = true;
                btnRun.textContent = '⏸ Pause';
                run();
            }
        });

        btnStep.addEventListener('click', () => {
            if (!isRunning) {
                step();
            }
        });

        btnReset.addEventListener('click', () => {
            isRunning = false;
            clearTimeout(animationTimeout);
            btnRun.textContent = '▶ Run';
            init();
        });

        document.querySelectorAll('.part-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentPart = parseInt(btn.dataset.part);
                isRunning = false;
                clearTimeout(animationTimeout);
                btnRun.textContent = '▶ Run';
                init();
            });
        });

        // Initialize on load
        init();
    </script>
</body>

</html>